<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEPROBA Task Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo::before {
            content: "üìã";
            font-size: 32px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-switcher {
            padding: 8px 16px;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        
        .navigation {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #636e72;
        }
        
        .nav-tab.active {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.3);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            font-size: 22px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            border-radius: 15px;
            color: white;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .task-item {
            padding: 20px;
            border-left: 4px solid #6c5ce7;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .task-item:hover {
            background: #e9ecef;
            border-left-color: #a29bfe;
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .task-title {
            font-weight: 600;
            color: #2d3436;
            font-size: 16px;
        }
        
        .task-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .task-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .status-not-started {
            background: #fab1a0;
            color: #d63031;
        }
        
        .status-in-progress {
            background: #fdcb6e;
            color: #e17055;
        }
        
        .status-completed {
            background: #55a3ff;
            color: #0984e3;
        }
        
        .status-done {
            background: #00b894;
            color: white;
        }
        
        .task-meta {
            display: flex;
            gap: 20px;
            font-size: 14px;
            color: #636e72;
            margin-bottom: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
        }
        
        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }
        
        .btn-success {
            background: #00b894;
            color: white;
        }
        
        .btn-warning {
            background: #fdcb6e;
            color: #e17055;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3436;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #6c5ce7;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #00b894, #55a3ff);
            transition: width 0.3s ease;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #00b894;
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .task-comments {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .comment {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .comment-author {
            font-weight: 600;
            color: #6c5ce7;
            margin-bottom: 5px;
        }
        
        .add-comment {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .comment-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .task-assignment {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .assignment-alert {
            color: #856404;
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .task-actions {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        .hierarchy-view {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .hierarchy-level {
            margin-left: 0;
            margin-bottom: 20px;
        }
        
        .hierarchy-level.level-1 { margin-left: 20px; }
        .hierarchy-level.level-2 { margin-left: 40px; }
        .hierarchy-level.level-3 { margin-left: 60px; }
        
        .hierarchy-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 4px solid #6c5ce7;
            margin-bottom: 10px;
            position: relative;
        }
        
        .hierarchy-item::before {
            content: "";
            position: absolute;
            left: -25px;
            top: 50%;
            width: 20px;
            height: 2px;
            background: #ddd;
        }
        
        .role-indicator {
            display: inline-block;
            padding: 3px 8px;
            background: #6c5ce7;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">KEPROBA Task Manager</div>
            <div class="user-info">
                <button class="user-switcher" onclick="switchUser()">Switch User</button>
                <div>
                    <div style="font-weight: 600;" id="current-user-name">Floice Mukabana</div>
                    <div style="font-size: 14px; color: #636e72;" id="current-user-role">Chief Executive Officer</div>
                </div>
                <div class="user-avatar" id="current-user-avatar">FM</div>
            </div>
        </header>
        
        <nav class="navigation">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showPage('dashboard')">üìä Dashboard</button>
                <button class="nav-tab" onclick="showPage('tasks')">‚úÖ My Tasks</button>
                <button class="nav-tab" onclick="showPage('create')">‚ûï Create Task</button>
                <button class="nav-tab" onclick="showPage('assigned')">üìã Assigned to Me</button>
                <button class="nav-tab" onclick="showPage('hierarchy')">üè¢ Organization</button>
            </div>
        </nav>
        
        <!-- Dashboard Page -->
        <div id="dashboard" class="page active">
            <div class="main-content">
                <div class="dashboard-card">
                    <h2 class="card-title">üìà My Overview</h2>
                    <div class="stats-grid" id="dashboard-stats">
                        <!-- Dynamic stats will be inserted here -->
                    </div>
                </div>
                
                <div class="dashboard-card">
                    <h2 class="card-title">üéØ Recent Activities</h2>
                    <div id="recent-activities">
                        <!-- Dynamic activities will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tasks Page -->
        <div id="tasks" class="page">
            <div class="dashboard-card full-width">
                <h2 class="card-title">‚úÖ My Tasks & Delegated Items</h2>
                <div id="my-tasks-list">
                    <!-- Dynamic tasks will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Assigned Tasks Page -->
        <div id="assigned" class="page">
            <div class="dashboard-card full-width">
                <h2 class="card-title">üìã Tasks Assigned to Me</h2>
                <div id="assigned-tasks-notice"></div>
                <div id="assigned-tasks-list">
                    <!-- Dynamic assigned tasks will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Create Task Page -->
        <div id="create" class="page">
            <div class="dashboard-card full-width">
                <h2 class="card-title">‚ûï Create New Task</h2>
                
                <form id="task-form" onsubmit="createTask(event)">
                    <div class="form-group">
                        <label class="form-label">Task Title*</label>
                        <input type="text" class="form-input" id="task-title" placeholder="Enter task title..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" rows="4" id="task-description" placeholder="Describe the task in detail..."></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Assign To*</label>
                            <select class="form-select" id="task-assignee" required>
                                <option value="">Select assignee...</option>
                                <!-- Dynamic options will be inserted here -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Priority</label>
                            <select class="form-select" id="task-priority">
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                                <option value="High">High</option>
                                <option value="Critical">Critical</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Due Date</label>
                            <input type="date" class="form-input" id="task-due-date">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Department</label>
                            <select class="form-select" id="task-department">
                                <option value="">Select department...</option>
                                <option value="Operations">Resource Center</option>
                                <option value="Finance">Finance</option>
                                <option value="Technology">Strategy</option>
                                <option value="Human Resources">PMDD</option>
                                <option value="Marketing">Branding</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="margin-top: 20px; padding: 12px 24px;">Create Task</button>
                </form>
            </div>
        </div>
        
        <!-- Hierarchy Page -->
        <div id="hierarchy" class="page">
            <div class="hierarchy-view">
                <h2 class="card-title">üè¢ Organizational Hierarchy & Task Distribution</h2>
                <div id="hierarchy-content">
                    <!-- Dynamic hierarchy will be inserted here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <script>
        // Global state management
        let currentUser = 'Floice_Mukabana';
        let tasks = [];
        let users = {
            john_doe: {
                name: 'Floice Mukabana',
                role: 'Chief Executive Officer',
                avatar: 'FM',
                level: 0,
                canAssignTo: ['rebecca_mpaayei', 'rueben_wanjala', 'victor_otieno', 'celestine_rono']
            },
            rebecca_mpaayei: {
                name: 'Rebecca Mpaayei',
                role: 'Manager PMDD',
                avatar: 'RM',
                level: 1,
                manager: 'floice_ mukabana',
                canAssignTo: ['esther_maina', 'jerry']
            },
            rueben_wanjala: {
                name: 'Reuben Wanjala',
                role: 'Director',
                avatar: 'RW',
                level: 1,
                manager: 'floice_mukabana',
                canAssignTo: ['whycliffe_rono']
            },
            victor_otieno: {
                name: 'Victor Otieno',
                role: 'Director',
                avatar: 'VO',
                level: 1,
                manager: 'floice_mukabana',
                canAssignTo: ['rebecca_mpaayei', 'wycliffe_rono']
            },
            celestine_rono: {
                name: 'Celestine Rono',
                role: 'Director',
                avatar: 'CR',
                level: 2,
                manager: 'floice_mukabana',
                canAssignTo: ['wycliffe_rono']
            },
            celestine_rono: {
                name: 'Celestine Rono',
                role: 'Director',
                avatar: 'CR',
                level: 2,
                manager: 'floice_mukabana',
                canAssignTo: ['wycliffe_rono']
            },
            leila_osman: {
                name: 'Leila Osman',
                role: 'ICT Officer',
                avatar: 'LO',
                level: 3,
                manager: 'Wycliffe_rono',
                canAssignTo: []
            },
        };
        
        // Initialize with sample tasks
        function initializeTasks() {
            tasks = [
                {
                    id: 1,
                    title: 'Q4 Strategic Planning',
                    description: 'Develop comprehensive strategic plan for Q4 including resource allocation and key initiatives.',
                    creator: 'floice_mukabana',
                    assignee: 'kirago',
                    status: 'in-progress',
                    priority: 'High',
                    dueDate: '2024-12-15',
                    department: 'Operations',
                    createdAt: new Date('2025-04-01'),
                    comments: [
                        { author: 'kirago', text: 'Started working on resource allocation section', timestamp: new Date() }
                    ]
                },
                {
                    id: 2,
                    title: 'Budget Review Meeting',
                    description: 'Conduct comprehensive budget review for all departments.',
                    creator: 'floice_mukabana',
                    assignee: 'mumo',
                    status: 'done',
                    priority: 'High',
                    dueDate: '2024-07-28',
                    department: 'Finance',
                    createdAt: new Date('2025-04-15'),
                    comments: []
                },
                {
                    id: 3,
                    title: 'Employee Performance Reviews',
                    description: 'Complete annual performance reviews for all team members.',
                    creator: 'floice_mukabana',
                    assignee: 'speranza',
                    status: 'not-started',
                    priority: 'Medium',
                    dueDate: '2025-06-10',
                    department: 'Human Resources',
                    createdAt: new Date('2025-05-20'),
                    comments: []
                },
                {
                    id: 4,
                    title: 'System Security Audit',
                    description: 'Perform comprehensive security audit of all IT systems.',
                    creator: 'reuben_wanjala',
                    assignee: 'edgar_mutua',
                    status: 'in-progress',
                    priority: 'Critical',
                    dueDate: '2024-12-05',
                    department: 'Resource Center',
                    createdAt: new Date('2025-01-18'),
                    comments: [
                        { author: 'reuben_wanjala', text: 'Completed network security assessment', timestamp: new Date() }
                    ]
                }
            ];
        }
        
        // Update user interface
        function updateUserInterface() {
            const user = users[currentUser];
            document.getElementById('current-user-name').textContent = user.name;
            document.getElementById('current-user-role').textContent = user.role;
            document.getElementById('current-user-avatar').textContent = user.avatar;
            
            updateAssigneeOptions();
            updateDashboard();
            updateTasksView();
            updateAssignedTasksView();
            updateHierarchyView();
        }
        
        // Update assignee dropdown options
        function updateAssigneeOptions() {
            const assigneeSelect = document.getElementById('task-assignee');
            const user = users[currentUser];
            
            assigneeSelect.innerHTML = '<option value="">Select assignee...</option>';
            
            if (user.canAssignTo) {
                user.canAssignTo.forEach(userId => {
                    const assignee = users[userId];
                    const option = document.createElement('option');
                    option.value = userId;
                    option.textContent = `${assignee.name} - ${assignee.role}`;
                    assigneeSelect.appendChild(option);
                });
            }
        }
        
        // Update dashboard statistics
        function updateDashboard() {
            const myTasks = getMyTasks();
            const assignedToMe = getAssignedToMe();
            const allMyTasks = [...myTasks, ...assignedToMe];
            
            const completed = allMyTasks.filter(t => t.status === 'done').length;
            const inProgress = allMyTasks.filter(t => t.status === 'in-progress').length;
            const notStarted = allMyTasks.filter(t => t.status === 'not-started').length;
            const overdue = allMyTasks.filter(t => new Date(t.dueDate) < new Date() && t.status !== 'done').length;
            
            const statsHTML = `
                <div class="stat-item">
                    <div class="stat-number">${allMyTasks.length}</div>
                    <div class="stat-label">Total Tasks</div>
                </div>
                <div class="stat-item" style="background: linear-gradient(135deg, #00b894, #00cec9);">
                    <div class="stat-number">${completed}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-item" style="background: linear-gradient(135deg, #fdcb6e, #e17055);">
                    <div class="stat-number">${inProgress}</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-item" style="background: linear-gradient(135deg, #fd79a8, #e84393);">
                    <div class="stat-number">${overdue}</div>
                    <div class="stat-label">Overdue</div>
                </div>
            `;
            
            document.getElementById('dashboard-stats').innerHTML = statsHTML;
            
            // Update recent activities
            const recentTasks = allMyTasks.slice(0, 3);
            const activitiesHTML = recentTasks.map(task => createTaskHTML(task, true)).join('');
            document.getElementById('recent-activities').innerHTML = activitiesHTML;
        }
        
        // Get tasks created by current user
        function getMyTasks() {
            return tasks.filter(task => task.creator === currentUser);
        }
        
        // Get tasks assigned to current user
        function getAssignedToMe() {
            return tasks.filter(task => task.assignee === currentUser);
        }
        
        // Create task HTML
        function createTaskHTML(task, isPreview = false) {
            const creator = users[task.creator];
            const assignee = users[task.assignee];
            const isMyTask = task.creator === currentUser;
            const isAssignedToMe = task.assignee === currentUser;
            
            let statusClass = `status-${task.status.replace('-', '-')}`;
            let statusText = task.status.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
            
            const progressWidth = task.status === 'done' ? 100 : 
                                task.status === 'completed' ? 80 :
                                task.status === 'in-progress' ? 50 : 0;
            
            return `
                <div class="task-item" data-task-id="${task.id}">
                    <div class="task-header">
                        <div class="task-title">${task.title}</div>
                        <div class="task-status ${statusClass}" onclick="cycleTaskStatus(${task.id})">${statusText}</div>
                    </div>
                    <div class="task-meta">
                        <span>üë§ ${isMyTask ? 'Assigned to: ' + assignee.name : 'From: ' + creator.name}</span>
                        <span>üìÖ Due: ${formatDate(task.dueDate)}</span>
                        <span>‚è∞ Priority: ${task.priority}</span>
                    </div>
                    ${task.description ? `<div style="margin-top: 10px; font-size: 14px; color: #636e72;">${task.description}</div>` : ''}
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressWidth}%;"></div>
                    </div>
                    ${!isPreview ? `
                        <div class="task-actions">
                            ${isAssignedToMe || isMyTask ? `<button class="btn btn-primary" onclick="updateTaskStatus(${task.id}, getNextStatus('${task.status}'))">${getNextStatusText(task.status)}</button>` : ''}
                            ${isMyTask ? `<button class="btn btn-secondary" onclick="editTask(${task.id})">Edit</button>` : ''}
                            <button class="btn btn-secondary" onclick="toggleComments(${task.id})">Comments (${task.comments.length})</button>
                        </div>
                        <div id="comments-${task.id}" class="task-comments" style="display: none;">
                            ${task.comments.map(comment => `
                                <div class="comment">
                                    <div class="comment-author">${users[comment.author].name}</div>
                                    <div>${comment.text}</div>
                                </div>
                            `).join('')}
                            <div class="add-comment">
                                <input type="text" class="comment-input" placeholder="Add a comment..." onkeypress="handleCommentKeypress(event, ${task.id})">
                                <button class="btn btn-primary" onclick="addComment(${task.id})">Add</button>
                            </div>
                        </div>` : ''}
                </div>
            `;
        }
        
        // Update tasks view
        function updateTasksView() {
            const myTasks = getMyTasks();
            const tasksHTML = myTasks.length > 0 ? 
                myTasks.map(task => createTaskHTML(task)).join('') :
                '<div style="text-align: center; padding: 40px; color: #636e72;">No tasks created yet. Create your first task!</div>';
            
            document.getElementById('my-tasks-list').innerHTML = tasksHTML;
        }
        
        // Update assigned tasks view
        function updateAssignedTasksView() {
            const assignedTasks = getAssignedToMe();
            const noticeDiv = document.getElementById('assigned-tasks-notice');
            
            if (assignedTasks.length > 0) {
                const pendingTasks = assignedTasks.filter(t => t.status !== 'done');
                if (pendingTasks.length > 0) {
                    noticeDiv.innerHTML = `
                        <div class="task-assignment">
                            <div class="assignment-alert">‚ö†Ô∏è You have ${pendingTasks.length} pending task(s) assigned to you!</div>
                            <div>Please review and update the status of your assigned tasks.</div>
                        </div>
                    `;
                } else {
                    noticeDiv.innerHTML = `
                        <div class="task-assignment" style="background: #d1ecf1; border-color: #bee5eb;">
                            <div class="assignment-alert" style="color: #0c5460;">‚úÖ Great job! All your assigned tasks are completed.</div>
                        </div>
                    `;
                }
            } else {
                noticeDiv.innerHTML = '';
            }
            
            const tasksHTML = assignedTasks.length > 0 ? 
                assignedTasks.map(task => createTaskHTML(task)).join('') :
                '<div style="text-align: center; padding: 40px; color: #636e72;">No tasks assigned to you yet.</div>';
            
            document.getElementById('assigned-tasks-list').innerHTML = tasksHTML;
        }
        
        // Update hierarchy view
        function updateHierarchyView() {
            const hierarchyHTML = `
                <div class="hierarchy-level">
                    <div class="hierarchy-item">
                        <strong>${users.Floice_Mukabana.name}</strong>
                        <span class="role-indicator">CEO</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('john_doe', 'creator')} | Assigned: ${getTaskCount('john_doe', 'assignee')} | Completed: ${getCompletedCount('john_doe')}
                        </div>
                    </div>
                </div>
                
                <div class="hierarchy-level level-1">
                    <div class="hierarchy-item">
                        <strong>${users.sarah_johnson.name}</strong>
                        <span class="role-indicator">VP Operations</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('sarah_johnson', 'creator')} | Assigned: ${getTaskCount('sarah_johnson', 'assignee')} | Completed: ${getCompletedCount('sarah_johnson')}
                        </div>
                    </div>
                    
                    <div class="hierarchy-item">
                        <strong>${users.michael_chen.name}</strong>
                        <span class="role-indicator">CFO</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('michael_chen', 'creator')} | Assigned: ${getTaskCount('michael_chen', 'assignee')} | Completed: ${getCompletedCount('michael_chen')}
                        </div>
                    </div>
                    
                    <div class="hierarchy-item">
                        <strong>${users.david_rodriguez.name}</strong>
                        <span class="role-indicator">CTO</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('david_rodriguez', 'creator')} | Assigned: ${getTaskCount('david_rodriguez', 'assignee')} | Completed: ${getCompletedCount('david_rodriguez')}
                        </div>
                    </div>
                </div>
                
                <div class="hierarchy-level level-2">
                    <div class="hierarchy-item">
                        <strong>${users.emily_watson.name}</strong>
                        <span class="role-indicator">HR Director</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('emily_watson', 'creator')} | Assigned: ${getTaskCount('emily_watson', 'assignee')} | Completed: ${getCompletedCount('emily_watson')}
                        </div>
                    </div>
                    
                    <div class="hierarchy-item">
                        <strong>${users.james_wilson.name}</strong>
                        <span class="role-indicator">IT Manager</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('james_wilson', 'creator')} | Assigned: ${getTaskCount('james_wilson', 'assignee')} | Completed: ${getCompletedCount('james_wilson')}
                        </div>
                    </div>
                </div>
                
                <div class="hierarchy-level level-3">
                    <div class="hierarchy-item">
                        <strong>${users.lisa_anderson.name}</strong>
                        <span class="role-indicator">Team Lead</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('lisa_anderson', 'creator')} | Assigned: ${getTaskCount('lisa_anderson', 'assignee')} | Completed: ${getCompletedCount('lisa_anderson')}
                        </div>
                    </div>
                    
                    <div class="hierarchy-item">
                        <strong>${users.mark_thompson.name}</strong>
                        <span class="role-indicator">Senior Developer</span>
                        <div style="margin-top: 5px; font-size: 14px; color: #636e72;">
                            Created: ${getTaskCount('mark_thompson', 'creator')} | Assigned: ${getTaskCount('mark_thompson', 'assignee')} | Completed: ${getCompletedCount('mark_thompson')}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('hierarchy-content').innerHTML = hierarchyHTML;
        }
        
        // Helper functions
        function getTaskCount(userId, role) {
            return tasks.filter(task => task[role] === userId).length;
        }
        
        function getCompletedCount(userId) {
            return tasks.filter(task => 
                (task.creator === userId || task.assignee === userId) && task.status === 'done'
            ).length;
        }
        
        function formatDate(dateString) {
            if (!dateString) return 'No due date';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        function getNextStatus(currentStatus) {
            const statusFlow = {
                'not-started': 'in-progress',
                'in-progress': 'completed',
                'completed': 'done',
                'done': 'in-progress'
            };
            return statusFlow[currentStatus] || 'in-progress';
        }
        
        function getNextStatusText(currentStatus) {
            const statusTexts = {
                'not-started': 'Start Task',
                'in-progress': 'Mark Complete',
                'completed': 'Mark Done',
                'done': 'Reopen Task'
            };
            return statusTexts[currentStatus] || 'Update Status';
        }
        
        // Task management functions
        function createTask(event) {
            event.preventDefault();
            
            const title = document.getElementById('task-title').value;
            const description = document.getElementById('task-description').value;
            const assignee = document.getElementById('task-assignee').value;
            const priority = document.getElementById('task-priority').value;
            const dueDate = document.getElementById('task-due-date').value;
            const department = document.getElementById('task-department').value;
            
            if (!title || !assignee) {
                showNotification('Please fill in all required fields!', 'error');
                return;
            }
            
            const newTask = {
                id: Date.now(),
                title,
                description,
                creator: currentUser,
                assignee,
                status: 'not-started',
                priority,
                dueDate,
                department,
                createdAt: new Date(),
                comments: []
            };
            
            tasks.push(newTask);
            document.getElementById('task-form').reset();
            
            showNotification(`Task "${title}" created and assigned to ${users[assignee].name}!`, 'success');
            updateUserInterface();
        }
        
        function updateTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const oldStatus = task.status;
                task.status = newStatus;
                
                // Add automatic comment when status changes
                const statusChangeComment = {
                    author: currentUser,
                    text: `Status changed from "${oldStatus.replace('-', ' ')}" to "${newStatus.replace('-', ' ')}"`,
                    timestamp: new Date()
                };
                task.comments.push(statusChangeComment);
                
                showNotification(`Task status updated to "${newStatus.replace('-', ' ')}"!`, 'success');
                updateUserInterface();
            }
        }
        
        function cycleTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && (task.assignee === currentUser || task.creator === currentUser)) {
                const newStatus = getNextStatus(task.status);
                updateTaskStatus(taskId, newStatus);
            }
        }
        
        function addComment(taskId) {
            const task = tasks.find(t => t.id === taskId);
            const commentInput = document.querySelector(`#comments-${taskId} .comment-input`);
            const commentText = commentInput.value.trim();
            
            if (task && commentText) {
                const newComment = {
                    author: currentUser,
                    text: commentText,
                    timestamp: new Date()
                };
                
                task.comments.push(newComment);
                commentInput.value = '';
                
                showNotification('Comment added!', 'success');
                updateUserInterface();
            }
        }
        
        function handleCommentKeypress(event, taskId) {
            if (event.key === 'Enter') {
                addComment(taskId);
            }
        }
        
        function toggleComments(taskId) {
            const commentsDiv = document.getElementById(`comments-${taskId}`);
            commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
        }
        
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && task.creator === currentUser) {
                // Simple edit implementation - could be expanded with a modal
                const newTitle = prompt('Edit task title:', task.title);
                if (newTitle && newTitle.trim()) {
                    task.title = newTitle.trim();
                    showNotification('Task updated!', 'success');
                    updateUserInterface();
                }
            }
        }
        
        // User switching functionality
        function switchUser() {
            const userOptions = Object.keys(users).map(userId => 
                `${users[userId].name} (${users[userId].role})`
            );
            
            const selectedIndex = prompt(
                'Switch to user:\n' + 
                userOptions.map((option, index) => `${index + 1}. ${option}`).join('\n') +
                '\n\nEnter number (1-' + userOptions.length + '):'
            );
            
            const index = parseInt(selectedIndex) - 1;
            const userIds = Object.keys(users);
            
            if (index >= 0 && index < userIds.length) {
                currentUser = userIds[index];
                showNotification(`Switched to ${users[currentUser].name}`, 'success');
                updateUserInterface();
            }
        }
        
        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update content based on page
            if (pageId === 'dashboard') updateDashboard();
            else if (pageId === 'tasks') updateTasksView();
            else if (pageId === 'assigned') updateAssignedTasksView();
            else if (pageId === 'hierarchy') updateHierarchyView();
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeTasks();
            updateUserInterface();
            
            // Set default due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('task-due-date').value = tomorrow.toISOString().split('T')[0];
            
            // Animate progress bars on page load
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.progress-fill');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 500);
        });
        
        // Add some interactive effects
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('task-item') || e.target.closest('.task-item')) {
                const taskItem = e.target.classList.contains('task-item') ? e.target : e.target.closest('.task-item');
                taskItem.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    taskItem.style.transform = 'scale(1)';
                }, 150);
            }
        });
    </script>
</body>
</html>